var HOME_PATH=window.HOME_PATH||".",map=new naver.maps.Map("map",{center:new naver.maps.LatLng(37.3812741,127.234358),zoom:15,minZoom:13,maxZoom:18,zoomControl:!0,zoomControlOptions:{position:naver.maps.Position.TOP_RIGHT},mapTypeId:naver.maps.MapTypeId.NORMAL});naver.maps.Event.addListener(map,"dragend",e=>{updateData(e.latlng._lat,e.latlng._lng)});var infowindow=new naver.maps.InfoWindow;function onSuccessGeolocation(e){var n=new naver.maps.LatLng(e.coords.latitude,e.coords.longitude);map.setCenter(n),updateData(e.coords.latitude,e.coords.longitude)}function onErrorGeolocation(e){console.log(e)}$(window).on("load",function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(onSuccessGeolocation,onErrorGeolocation);else{var e=map.getCenter();infowindow.setContent('<div style="padding:20px;"><h5 style="margin-bottom:5px;color:#f00;">Geolocation not supported</h5></div>'),infowindow.open(map,e)}updateData(37.3812741,127.234358)});const markers=[],clearMakers=()=>{for(const e in markers)markers[e].setMap(null);markers.length=0},infoWindow=new naver.maps.InfoWindow({backgroundColor:"rgba(66,66,66)",anchorColor:"rgba(66,66,66)"}),updateData=(e,n)=>{clearMakers();const o=new XMLHttpRequest;o.addEventListener("load",()=>{(e=>{const n=document.createElement("table");n.className="table";const o=["이름","입고시간","데이터생성시간","재고상태"],t=document.createElement("thead");for(let e=0;e<o.length;e++){const n=document.createElement("th");n.innerHTML=o[e],t.appendChild(n)}n.appendChild(t);for(const o in e.stores){const t=e.stores[o].code,a=e.stores[o].name,s=e.stores[o].addr,r=e.stores[o].type,i=e.stores[o].lat,d=e.stores[o].lng,l=e.stores[o].stock_at,c=e.stores[o].remain_stat,p=e.stores[o].created_at;if("01"!==r)continue;if(""==c||null==c||"empty"==c||"break"==c)continue;const m={plenty:{desc:"100개 이상",txt:"넉넉",bsClass:"badge-success"},some:{desc:"30개 이상",txt:"적당",bsClass:"badge-warning"},few:{desc:"30개 미만",txt:"부족",bsClass:"badge-secondary"}};try{const e=new naver.maps.Marker({position:new naver.maps.LatLng(i,d),map:map,icon:{content:'<h6><span class="badge '+m[c].bsClass+'">'+m[c].txt+"</span></h6>",anchor:new naver.maps.Point(10,10)},draggable:!1});markers.push(e)}catch(e){console.log(c),console.log(m[c]),console.log(e)}naver.maps.Event.addListener(storeMarker,"click",()=>{infoWindow.setContent(`\n                    <div style="text-align:left;padding:10px;color:white;">\n                        <div>${a}</div>\n                        <div>${s}</div>\n                        <div>입고시간 : ${l}</div>\n                        <div>데이터생성시간 : ${p}</div>\n                        <div>재고상태 : ${m[c].desc}</div>\n                    </div>\n                `),infoWindow.getMap()&&infoWindow.close(),infoWindow.open(map,storeMarker)});const g=n.insertRow(-1);let v;g.dataset.store_code=t,(v=g.insertCell(-1)).innerHTML=a,(v=g.insertCell(-1)).innerHTML=l,(v=g.insertCell(-1)).innerHTML=p,(v=g.insertCell(-1)).innerHTML=m[c].desc,naver.maps.Event.addListener(map,"click",()=>{infoWindow.setMap(null)});const w=document.getElementsByClassName("dataTable")[0];w.innerHTML="",w.appendChild(n)}})(JSON.parse(o.responseText))});const t="https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat="+e+"&lng="+n+"&m=10000";o.open("GET",t),o.send()};
