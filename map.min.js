var HOME_PATH=window.HOME_PATH||".",map=new naver.maps.Map("map",{center:new naver.maps.LatLng(37.3812741,127.234358),zoom:15,minZoom:13,maxZoom:18,zoomControl:!0,zoomControlOptions:{position:naver.maps.Position.TOP_RIGHT},mapTypeId:naver.maps.MapTypeId.NORMAL});naver.maps.Event.addListener(map,"dragend",n=>{updateData(n.latlng._lat,n.latlng._lng)});var infowindow=new naver.maps.InfoWindow;function onSuccessGeolocation(n){var e=new naver.maps.LatLng(n.coords.latitude,n.coords.longitude);map.setCenter(e),updateData(n.coords.latitude,n.coords.longitude)}function onErrorGeolocation(n){console.log(n)}$(window).on("load",function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(onSuccessGeolocation,onErrorGeolocation);else{var n=map.getCenter();infowindow.setContent('<div style="padding:20px;"><h5 style="margin-bottom:5px;color:#f00;">Geolocation not supported</h5></div>'),infowindow.open(map,n)}updateData(37.3812741,127.234358)});const markers=[],clearMakers=()=>{for(const n in markers)markers[n].setMap(null);markers.length=0},infoWindow=new naver.maps.InfoWindow({backgroundColor:"rgba(66,66,66)",anchorColor:"rgba(66,66,66)"}),updateData=(n,e)=>{clearMakers();const o=new XMLHttpRequest;o.addEventListener("load",()=>{(n=>{const e=document.createElement("table");e.className="table";const o=["이름","입고시간","데이터생성시간","재고상태"],t=document.createElement("thead");for(let n=0;n<o.length;n++){const e=document.createElement("th");e.innerHTML=o[n],t.appendChild(e)}e.appendChild(t);for(const o in n.stores){const t=n.stores[o].code,a=n.stores[o].name,s=n.stores[o].addr,r=n.stores[o].type,i=n.stores[o].lat,d=n.stores[o].lng,l=n.stores[o].stock_at,c=n.stores[o].remain_stat,p=n.stores[o].created_at;if("01"!==r)continue;if(""==c||null==c||"empty"==c)continue;const m={plenty:{desc:"100개 이상",txt:"넉넉",bsClass:"badge-success"},some:{desc:"30개 이상",txt:"적당",bsClass:"badge-warning"},few:{desc:"30개 미만",txt:"부족",bsClass:"badge-secondary"}},v=new naver.maps.Marker({position:new naver.maps.LatLng(i,d),map:map,icon:{content:'<h6><span class="badge '+m[c].bsClass+'">'+m[c].txt+"</span></h6>",anchor:new naver.maps.Point(10,10)},draggable:!1});markers.push(v),naver.maps.Event.addListener(v,"click",()=>{infoWindow.setContent(`\n                    <div style="text-align:left;padding:10px;color:white;">\n                        <div>${a}</div>\n                        <div>${s}</div>\n                        <div>입고시간 : ${l}</div>\n                        <div>데이터생성시간 : ${p}</div>\n                        <div>재고상태 : ${m[c].desc}</div>\n                    </div>\n                `),infoWindow.getMap()&&infoWindow.close(),infoWindow.open(map,v)});const g=e.insertRow(-1);let w;g.dataset.store_code=t,(w=g.insertCell(-1)).innerHTML=a,(w=g.insertCell(-1)).innerHTML=l,(w=g.insertCell(-1)).innerHTML=p,(w=g.insertCell(-1)).innerHTML=m[c].desc,naver.maps.Event.addListener(map,"click",()=>{infoWindow.setMap(null)});const u=document.getElementsByClassName("dataTable")[0];u.innerHTML="",u.appendChild(e)}})(JSON.parse(o.responseText))});const t="https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat="+n+"&lng="+e+"&m=10000";o.open("GET",t),o.send()};
